<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8f9fa; padding: 20px; }
        .main-card { max-width: 500px; margin: auto; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); padding: 25px; }
        .app-item { display: flex; align-items: center; padding: 15px; background: #fff; border: 1px solid #eee; border-radius: 15px; margin-bottom: 10px; text-decoration: none; color: #333; transition: 0.2s; }
        .app-item:hover { transform: translateY(-3px); border-color: #0d6efd; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .icon { width: 45px; height: 45px; background: #e7f0ff; color: #0d6efd; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px; }
        .loading { text-align: center; padding: 20px; color: #888; }
    </style>
</head>
<body>

    <div class="main-card">
        <h2 class="text-center fw-800 mb-1">LUQMAN HUB</h2>
        <p class="text-center text-muted small mb-4">Pusat Akses Aplikasi</p>

        <div class="mb-4 p-3 bg-light rounded-3">
            <input type="text" id="desc" class="form-control mb-2" placeholder="Nama Aplikasi">
            <input type="text" id="url" class="form-control mb-3" placeholder="URL Link">
            <button onclick="saveData()" id="btnSave" class="btn btn-primary w-100 fw-bold">TAMBAH SEKARANG</button>
        </div>

        <div id="display-list">
            <div class="loading">Memuatkan menu...</div>
        </div>
    </div>

    <script>
        // Jalankan fungsi load sebaik sahaja page dibuka
        document.addEventListener('DOMContentLoaded', function() {
            loadApps();
        });

        function loadApps() {
            google.script.run
                .withSuccessHandler(renderList)
                .withFailureHandler(function(err) {
                    document.getElementById('display-list').innerHTML = "Ralat: " + err;
                })
                .getMenuData();
        }

        function renderList(data) {
            const listDiv = document.getElementById('display-list');
            if (!data || data.length === 0) {
                listDiv.innerHTML = "<p class='text-center text-muted'>Tiada aplikasi dijumpai.</p>";
                return;
            }

            let html = '';
            // Susun yang terbaru di atas
            data.reverse().forEach(row => {
                if (row[0] && row[1]) {
                    const char = row[0].charAt(0).toUpperCase();
                    html += `
                        <a href="${row[1]}" target="_blank" class="app-item">
                            <div class="icon">${char}</div>
                            <div>
                                <div class="fw-bold">${row[0]}</div>
                                <div class="small text-muted">Buka aplikasi âž”</div>
                            </div>
                        </a>`;
                }
            });
            listDiv.innerHTML = html;
        }

        function saveData() {
            const d = document.getElementById('desc').value;
            const u = document.getElementById('url').value;
            if (!d || !u) return alert("Lengkapkan maklumat!");

            document.getElementById('btnSave').disabled = true;
            document.getElementById('btnSave').innerText = "Menyimpan...";

            google.script.run.withSuccessHandler(function() {
                document.getElementById('desc').value = '';
                document.getElementById('url').value = '';
                document.getElementById('btnSave').disabled = false;
                document.getElementById('btnSave').innerText = "TAMBAH SEKARANG";
                loadApps();
            }).addLink(d, u);
        }
    </script>
</body>
</html>
