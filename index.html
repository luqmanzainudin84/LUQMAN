<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f0f2f5; padding: 20px; }
    .container { max-width: 500px; margin: auto; }
    .card-menu { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 15px; text-decoration: none; color: black; display: block; }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="text-center mb-4">LUQMAN HUB</h2>
    
    <div class="bg-white p-3 rounded-3 shadow-sm mb-4">
      <input type="text" id="nama" class="form-control mb-2" placeholder="Nama App">
      <input type="text" id="link" class="form-control mb-3" placeholder="Link App">
      <button onclick="simpan()" id="btnSimpan" class="btn btn-primary w-100">TAMBAH APP</button>
    </div>

    <div id="senarai">Memuatkan data dari Sheets...</div>
  </div>

  <script>
    // Ini cara "attached" HTML dengan Apps Script tanpa perlukan link URL
    window.onload = function() {
      muatTurunData();
    };

    function muatTurunData() {
      google.script.run
        .withSuccessHandler(paparSenarai)
        .withFailureHandler(err => alert("Gagal ambil data: " + err))
        .getMenuData();
    }

    function paparSenarai(data) {
      let html = "";
      data.reverse().forEach(row => {
        if(row[0] && row[1]) {
          html += `
            <a href="${row[1]}" target="_blank" class="card-menu">
              <strong>${row[0]}</strong><br>
              <small class="text-muted">${row[1]}</small>
            </a>`;
        }
      });
      document.getElementById('senarai').innerHTML = html;
    }

    function simpan() {
      let n = document.getElementById('nama').value;
      let l = document.getElementById('link').value;
      if(!n || !l) return alert("Isi semua!");

      document.getElementById('btnSimpan').disabled = true;
      google.script.run.withSuccessHandler(() => {
        document.getElementById('nama').value = "";
        document.getElementById('link').value = "";
        document.getElementById('btnSimpan').disabled = false;
        muatTurunData(); // Refresh senarai
      }).addLink(n, l);
    }
  </script>
</body>
</html>
